<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>${site.name}</title>
    <meta http-equiv="keywords" content="${site.keywords!}"/>
    <meta http-equiv="description" content="${site.description!}"/>
    <script src="${resSys}/jquery.js" type="text/javascript"></script>
    <script src="${resSys}/front.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="/${res}/css/common2.css">
    <link rel="stylesheet" type="text/css" href="/${res}/css/index2.css">
	<script src="/${res}/js/region.js" type="text/javascript"></script>
	<style type="text/css">
		#userImg {
			
	position: absolute;
    left: 0;
    bottom: 0;
    opacity: 0;
    width: 100px;
    height: 30px;
    cursor: pointer;

		}
	</style>
</head>


<body>
    <header>
        <div class="head">
            <img src="/${res}/img/logo.png">
            <ul>
				<li><a class="color-dfbc6f" href="${site.url!}">首页</a></li>
				<li>[@cms_channel id='76']<a class="color-dfbc6f" href="${tag_bean.url}">${tag_bean.name}</a>[/@cms_channel]</li>
				<li>[@cms_channel id='94']<a class="color-dfbc6f" href="${tag_bean.url}">${tag_bean.name}</a>[/@cms_channel]</li>
				<li>[@cms_channel id='97']<a class="color-dfbc6f" href="${tag_bean.url}">${tag_bean.name}</a>[/@cms_channel]</li>
				<li>[@cms_channel id='100']<a class="color-dfbc6f" href="${tag_bean.url}">${tag_bean.name}</a>[/@cms_channel]</li>
				<li>[@cms_channel id='101']<a class="color-dfbc6f" href="${tag_bean.url}">${tag_bean.name}</a>[/@cms_channel]</li>
			</ul>
            <div id="loginCsiDiv" style="float: right;"></div>
		  	<script type="text/javascript">
			$(function(){
				[#if site.config.ssoEnable]
				Cms.loginSSO('${base}');
				[/#if]
				Cms.loginCsi("${base}","loginCsiDiv",{"returnUrl":"${location}"});
				
		[#if (cmsUserExt.companyAddressProvince)?? &&cmsUserExt.companyAddressProvince?length gt 1 && (cmsUserExt.companyAddressCity)?? && cmsUserExt.companyAddressCity?length gt 1]
		   	loadData(companyAddressProvince,${(cmsUserExt.companyAddressProvince)},companyAddressCity,${(cmsUserExt.companyAddressCity)});
		[#else]
		    loadData(companyAddressProvince,000000,companyAddressCity,000000);
		[/#if]
			});
		   </script>
        </div>
    </header>
    <section class="body_bg">
           <div class="u_content">
                 <div class="user_left">
                      <ul>
                           <li><a href="/personal/arrive_center.jspx" class="user_left_hover"><span>基本信息</span></a></li>
                           <li><a href="/investor/investorQualificationInfo.jspx"><span>投资人认证</span></a></li>
                           <li><a href="/personal/project_release.jspx"><span>发布项目</span></a></li>
                           <li><a href="/releaseTransfer/transferInfo.jspx"><span>发布转让</span></a></li>
                           <li><a href="/projectManager/page.jspx"><span>项目管理</span></a></li>
                           <li><a href="/messageNotice/messagePage.jspx"><span>消息通知</span></a></li>
                           <li><a href="/personal/account_security.jspx"><span>账号安全</span></a></li>
                      </ul>
                 </div>
                 <div class="user_right">
                   <div class="user01">
                           <div class="user_1">
<!--                                 <div class="img"> -->
<!--                                 [#if user.userImg??]<img class="uploadPic" src="${user.userImg}">[#else]<img class="uploadPic" src="/${res}/img/userImg.png">[/#if] -->
<!--                                 <a class="usrephoto">上传头像</a> -->
<!--                                 <input id="userImg" type="file" accept="image/png, image/jpeg, image/gif, image/jpg" name="" class="fileSty"> -->
<!--                              </div>  -->
                             <div class="img upload">
								[#if user.userImg??]<img class="uploadPic" src="${user.userImg}">[#else]<img class="uploadPic" src="/${res}/img/userImg.png">[/#if]
								<button class="usrephoto">上传头像</button>
								<input id="userImg" type="file" accept="image/png, image/jpeg, image/gif, image/jpg" name="" class="fileSty">
							</div>
							<style>
								.upload{
							    position: relative;
						}
						
							</style>
                             <div class="font">
                                      <font>${cmsUserExt.realname}</font> 
                                      <span><a href=""><img src="/${res}/img/rz01.png"></a>
                                            <div class="renz">投资认证</div>
                                      </span>
                                      <span><a href=""><img src="/${res}/img/rz02.png"></a>
                                          <div class="renz02"  style="display: none">投资认证</div>
                                      </span>
                                      <span><a href=""><img src="/${res}/img/rz03.png"></a>
                                       <div class="renz03" style="display: none">投资认证</div>
                                      </span>
                                </div>
                             <div class="user_02">
                                     <span>公司名称：<i>${cmsUserExt.companyName}</i></span>
                                     <span>手机：<i>${cmsUserExt.phone}</i></span>
                                     <span>公司类型：<i>${companyType}</i></span>
                                     <span>邮箱：<i>${email}</i></span>
                                </div>
                     </div>
                      </div>
                      <!---------->
                               <input id="sexsex" value="${sex}" type="hidden" />
                               <input id="educationHide" value="${cmsUserExt.education}" type="hidden" />
                               <input id="companyCatagroyHide" value="${cmsUserExt.companyType!''}" type="hidden" />
                      <div class="usertab">
                           <table>
                               <tr>
                                  <td width="130" valign="top"><i>*</i>手机号码：</td>
                                  <td width="770"><input name="" type="text" readonly="readonly" class="ustext left" value="${cmsUserExt.phone}"/>
                                  <a  href="personal_choose.jspx?wantChange=phone" class="left">更换手机号</a>
                                  </td>
                               </tr>
                               <tr>
                                  <td><i>*</i>姓名：</td>
                                  <td><input name="" type="text" class="ustext01 left" readonly="readonly" value="${cmsUserExt.realname}"></td>
                               </tr>
                               <tr>
                                  <td><i>*</i>性别：</td>
                                  <td><select id="sex" name="gender" class="ustext02 left">
                                  		<option value="1">男</option>
                                  		<option value="0">女</option>
                                  	  </select></td>
                               </tr>
                               <tr>
                                  <td><i>*</i>学历：</td>
                                  <td><select id="education" name="" class="ustext02 left">
                                  		<option value="1">初中</option>
                                  		<option value="2">高中</option>
                                  		<option value="3">本科</option>
                                  		<option value="4">硕士</option>
                                  		<option value="5">博士</option>
                                  		<option value="6">其他</option>
                                  	  </select></td>
                               </tr>
                               <tr>
                                  <td>固定电话</td>
                                  <td><input id="localPhone" name="" type="text" class="ustext_1 left" value="${cmsUserExt.mobile!}"></td>
                               </tr>
                               <tr>
                                  <td>微信号</td>
                                  <td><input id="msn" name="" type="text" class="ustext_1 left" value="${cmsUserExt.msn!}"></td>
                               </tr>
                               <tr>
                                  <td>QQ</td>
                                  <td><input id="qq" name="" type="text" class="ustext_1 left" value="${cmsUserExt.qq!}"></td>
                               </tr>
                               <tr>
                                  <td valign="top"><i>*</i>电子邮箱：</td>
                                  <td><input id="testEmail" name="" type="text" class="ustext left" value="${email}" readonly="readonly"><a  href="personal_choose.jspx?wantChange=email" class="left">更改邮箱</a></td>
                               </tr>
                               <tr>
                                  <td><i>*</i>公司名称：</td>
                                  <td><input name="" type="text" class="ustext_1 left" value="${cmsUserExt.companyName!}"></td>
                               </tr>
                               <tr>
                                  <td><i>*</i>公司类别：</td>
                                  <td>
                                  <select id="companyCatagroy" name="companyType" class="fbtext_2 left" >
                                  <option value="">请选择</option>
                                  [#if investFiledList??]
	                                  	[#list investFiledList as investFiled]
		                                  	[#if (cmsUserExt.companyType)??]
		                                  		[#assign industryArray = (cmsUserExt.companyType?split(","))]
		                                  		<option value="${investFiled.value!}" [#if industryArray?seq_contains(investFiled.value)]selected="selected"[/#if]>${investFiled.name!}</option>
		                                  	[#else]
		                                  	<option value="${investFiled.value!}">${investFiled.name!}</option>
		                                  	[/#if]
	                                  	[/#list]
	                                  [/#if]
                                  </select>
                                  </td>
                               </tr>
                               <tr>
                                  <td valign="top">地址：</td>
                                  <td>
                                  <div>
										<select id="companyAddressProvince" name="companyAddressProvince"  onchange="chgProvinces(companyAddressProvince,companyAddressCity)" class="ustext_1 left">
											<option></option>
										</select>
										<select id="companyAddressCity" name="companyAddressCity" class="ustext_1 left">
											<option></option>
										</select>
                                  </div>
                                  <br>
                                  <input id="adressDetail" name="companyAddressDetail" type="text" class="ustext_1 martop left" value="${cmsUserExt.companyAddressDetail}">
                                  </td>
                               </tr>
                               <tr>
                                  <td><i>*</i>职务：</td>
                                  <td><input id="position" name="companyPosition" class="ustext02 left" value="${cmsUserExt.companyPosition}" /></td>
                               </tr>
                               <tr>
                                  <td valign="top">个人简介：</td>
                                  <td><textarea name="companyIntro" cols="" rows="" class="ustextarea left" placeholder="请填写公司简介和企业投融案例">${cmsUserExt.companyIntro!}</textarea></td>
                               </tr>
                               <tr>
                                  <td valign="top">公司简介：</td>
                                  <td><textarea name="intro" cols="" rows="" class="ustextarea left"  placeholder="请填写公司简介和企业投融案例">${cmsUserExt.intro!}</textarea></td>
                               </tr>
                               <tr>
                                  <td></td>
                                  <td><button id="saveInfo" class="button left">保存</button></td>
                               </tr>
                           </table>
                   </div>
                      <!---------->
             </div>
           </div>
    </section>
    <footer>
        <div class="foot">
            <div class="floatLeft entrys">
                <table>
                    <tr>
                        <td><a href="">首页</a></td>
                        <td><a href="">活动中心</a></td>
                        <td><a href="">资讯中心</a></td>
                        <td><a href="">帮助中心</a></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><a href="">沙龙活动</a></td>
                        <td><a href="">最新资讯</a></td>
                        <td><a href="">申请入驻</a></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><a href="">金融教育</a></td>
                        <td><a href="">政策解读</a></td>
                        <td><a href="">联系我们</a></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><a href="">项目路演</a></td>
                        <td><a href=""></a></td>
                        <td><a href="">意见反馈</a></td>
                    </tr>
                </table>
            </div>
            <div class="line floatLeft"></div>
            <div class="floatRight qrCode">
                <div class="floatRight mgl-50">
                    <img src="/${res}/img/service.png">
                    <div>服务号二维码</div>
                </div>
                <div class="floatRight">
                    <img src="/${res}/img/subscribe.png">
                    <div>订阅号二维码</div>
                </div>
            </div>
        </div>
    </footer>
</body>
<script type="text/javascript" src="/${res}/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript">
	document.querySelector('.fileSty').onchange = function(e){
		document.querySelector('.uploadPic').setAttribute('src',window.URL.createObjectURL(e.target.files[0]));
	};
</script>
<script type="text/javascript">
	var sex = $("#sexsex").val();
	$("#sex").val(sex);
	
	var education = $("#educationHide").val();
	$("#education").val(education);
	
	var companyCatagroy = $("#companyCatagroyHide").val();
	$("#companyCatagroy").val(companyCatagroy);
</script>
<script type="text/javascript">
</script>
<script type="text/javascript">
$("#saveInfo").click(function() {

	var sex = $("#sex").val()=="1" ? true:false;
	var graduate = $("#education").val();
	var localPhone = $("#localPhone").val();
	var qq = $("#qq").val();
	var msn = $("#msn").val();
	var companyName = $("#companyName").val();
	var companyCatagroy = $("#companyCatagroy").val();
	var adress_province = $("#companyAddressProvince").val();
	var adress_city = $("#companyAddressCity").val();
	var adressDetail = $("#adressDetail").val();
	var companyPosition = $("#position").val();
	var companyIntroduce = $("#companyIntroduce").val();
	var personalDetail = $("#personalDetail").val();
	var provinceName = $("#companyAddressProvince :selected").text();
	var cityName = $("#companyAddressCity :selected").text();
	var companyIntro = $("#companyIntro").val();
	var intro = $("#intro").val();

	if(localPhone==null||localPhone==""){
		alert("固定电话不能为空");
	}
	if(companyPosition==null||companyPosition==""){
		alert("职务不能为空");
	}
	if(companyCatagroy==null||companyCatagroy==""){
		alert("请选择一个行业");
	}
	
	var value = {
		
			gender : sex,
			education : graduate,
			mobile : localPhone,
			qq : qq,
			msn : msn,
			companyName : companyName,
			companyType : companyCatagroy,
			companyAddressProvince : adress_province,
			companyAddressCity : adress_city,
			companyAddressDetail : adressDetail,
			companyPosition: companyPosition,
			companyIntro:companyIntroduce,
			intro:intro,
			companyIntro:companyIntro,
			provinceName:provinceName,
			cityName:cityName,
			userImg:""
	};
	
var fileObj = document.getElementById("userImg").files[0]; 

	if(fileObj!=undefined){
		var filename=getFileName($("#userImg").val());
		function getFileName(o){
		    var pos=o.lastIndexOf("\\");
		    return o.substring(pos+1);  
		}
		 var formData = new FormData();
		 formData.append("filename", filename); // 文件对象  
		 formData.append("uploadFile", fileObj); // 文件对象
		 formData.append("mark",true);
		 formData.append("imgType","userImg");
		
		
		
		$.ajax({
				url : '/member/o_upload_image.jspx',
				type : 'post',
				data : formData,
				async : false, // 默认为true 异步
				cache: false,//上传文件无需缓存 
				processData: false,//用于对data参数进行序列化处理 这里必须false
				contentType: false, //必须 
				error : function() {
					alert('error');
				},
				success : function(data) {
					alert(data);
					registerUser(data,value);
				}
		});
	}else{
		registerUser("",value);
	};
	
});

function registerUser(path,value){
	value.userImg=path;
	$.ajax({
		url : '/personal/update_baseinfo.jspx',
		type : 'post',
		data : value,
		async : false, // 默认为true 异步
		error : function(data) {
			alert('error '+data);
		},
		success : function(data) {
		if(data=="o"){
			window.location.href="arrive_center.jspx";}
			else{
				alert('保存数据异常，请重新尝试');
			}
		}
	});
}
</script>

</html>